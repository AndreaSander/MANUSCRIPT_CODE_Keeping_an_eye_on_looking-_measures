group_by(trial_number, recording_name) %>%
filter(looking_stretch_id == min(looking_stretch_id)) %>%
ungroup() %>%
distinct(recording_name, trial_number, media_name, first_look_dur) %>%
ungroup()
first_look_duration_by_subject <- first_look_duration_by_trial %>%
group_by(recording_name) %>%
summarise(first_look_dur = mean(first_look_dur, na.rm = T)) %>%
ungroup()
data_new_dvs_by_trial <- analysis_dataset %>%
distinct(recording_name, trial_number, yoked_pair, target_word, age_months, exp_to_target_lang) %>%
left_join(prop_looking_by_trial) %>%
#double check if kids see the same word more than once... if so, this item will be ducplicated in the dataset
left_join(prop_looking_diff_by_item) %>%
# commenting out for now until we verify how to do this one left_join(sampling_fixations_total %>% select(-subject_id)) %>%
left_join(fixations_total_by_trial) %>%
left_join(prop_shifts_distractor_initial_by_trial) %>%
left_join(RT_by_trial) %>%
left_join(number_of_switches_by_trial) %>%
left_join(mean_fixation_dur_by_trial) %>%
left_join(peak_dilation_by_trial) %>%
left_join(mean_dilation_by_trial) %>%
left_join(peak_pupil_latency_by_trial) %>%
left_join(first_look_duration_by_trial) %>%
ungroup() %>%
mutate(exp_to_target_lang_centred = (exp_to_target_lang/100)-.5,
age_months_centred = age_months - 25,
correct_shift = case_when(correct_shift == T ~ 1,
correct_shift == F ~ 0))
data_new_dvs_by_subject <- analysis_dataset %>%
distinct(recording_name, age_months, exp_to_target_lang) %>%
left_join(prop_looking_by_subject) %>%
#double check if kids see the same word more than once... if so, this item will be ducplicated in the dataset
left_join(prop_looking_diff_by_subject) %>%
# commenting out for now until we verify how to do this one left_join(sampling_fixations_total %>% select(-subject_id)) %>%
left_join(fixations_total_by_subject) %>%
left_join(prop_shifts_distractor_initial_by_subject) %>%
left_join(RT_by_subject) %>%
left_join(number_of_switches_by_subject) %>%
left_join(mean_fixation_dur_by_subject) %>%
left_join(peak_dilation_by_subject) %>%
left_join(mean_dilation_by_subject) %>%
left_join(peak_pupil_latency_by_subject) %>%
left_join(first_look_duration_by_subject) %>%
ungroup()
first_shift_target <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 1800) %>% #Keeping the shorter window to be consistent with Fernald
#Grouping and summarizing to get by subject by trial flagging of whether there was switching or not.
group_by(recording_name, subject_id, trial_number, media_name, initial_look) %>%
summarise(target = sum(target, na.rm = T),
distractor =  sum(distractor, na.rm = T)) %>% #Counting how many looks to target and distractor by timeslice grouped by target or distractor initial trials.
ungroup() %>%
mutate(correct_shift = case_when(initial_look == "target" & distractor ==0 ~ TRUE,
initial_look == "distractor" & target >0 ~ TRUE,
TRUE~FALSE)) #Making a column to calculate correct shifts. We defined correct shift as never looking to the distractor on target initial trial, or switching to the taget on distractor initial trials
prop_shifts_distractor_initial_by_trial <- first_shift_target %>%
filter(initial_look == "distractor")
prop_shifts_distractor_initial_by_subject <- prop_shifts_distractor_initial_by_trial %>%
group_by(recording_name) %>%
summarise(prop_shift_distractor_initial = sum(correct_shift == TRUE)/n())
prop_shifts_target_initial_by_trial <- first_shift_target %>%
filter(initial_look == "target")
prop_shifts_target_initial_by_subject <- prop_shifts_target_initial_by_trial %>%
group_by(recording_name) %>%
summarise(prop_shift_target_initial = sum(correct_shift == TRUE)/n())
data_new_dvs_by_trial <- analysis_dataset %>%
distinct(recording_name, trial_number, yoked_pair, target_word, age_months, exp_to_target_lang) %>%
left_join(prop_looking_by_trial) %>%
#double check if kids see the same word more than once... if so, this item will be ducplicated in the dataset
left_join(prop_looking_diff_by_item) %>%
# commenting out for now until we verify how to do this one left_join(sampling_fixations_total %>% select(-subject_id)) %>%
left_join(fixations_total_by_trial) %>%
left_join(prop_shifts_distractor_initial_by_trial) %>%
left_join(RT_by_trial) %>%
left_join(number_of_switches_by_trial) %>%
left_join(mean_fixation_dur_by_trial) %>%
left_join(peak_dilation_by_trial) %>%
left_join(mean_dilation_by_trial) %>%
left_join(peak_pupil_latency_by_trial) %>%
left_join(first_look_duration_by_trial) %>%
ungroup() %>%
mutate(exp_to_target_lang_centred = (exp_to_target_lang/100)-.5,
age_months_centred = age_months - 25,
correct_shift = case_when(correct_shift == T ~ 1,
correct_shift == F ~ 0))
data_new_dvs_by_subject <- analysis_dataset %>%
distinct(recording_name, age_months, exp_to_target_lang) %>%
left_join(prop_looking_by_subject) %>%
#double check if kids see the same word more than once... if so, this item will be ducplicated in the dataset
left_join(prop_looking_diff_by_subject) %>%
# commenting out for now until we verify how to do this one left_join(sampling_fixations_total %>% select(-subject_id)) %>%
left_join(fixations_total_by_subject) %>%
left_join(prop_shifts_distractor_initial_by_subject) %>%
left_join(RT_by_subject) %>%
left_join(number_of_switches_by_subject) %>%
left_join(mean_fixation_dur_by_subject) %>%
left_join(peak_dilation_by_subject) %>%
left_join(mean_dilation_by_subject) %>%
left_join(peak_pupil_latency_by_subject) %>%
left_join(first_look_duration_by_subject) %>%
ungroup()
#PEARSON CORRELATION
for_correlation<- data_new_dvs_by_subject %>%
select(where(is.numeric))
kbh_correlation <- cor(x=for_correlation, use="pairwise.complete.obs")
#plotting the correlation
corrplot(kbh_correlation)
library(lmerTest)
#Prop Looking Models
prop_looking_simple <- lmer(prop_looking ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(prop_looking_simple)
prop_looking_interaction <- lmer(prop_looking ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(prop_looking_interaction)
#Prop Looking Diff Models
prop_looking_diff_simple <- lmer(prop_looking_diff ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(prop_looking_diff_simple)
prop_looking_diff_interaction <- lmer(prop_looking_diff ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(prop_looking_diff_interaction)
#Number fixations Models
number_fixations_simple <- lmer(number_fixations ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(number_fixations_simple)
number_fixations_interaction <- lmer(number_fixations ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(number_fixations_interaction)
#Latency to switch Models
latency_to_switch_simple <- lmer(latency_to_switch ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(latency_to_switch_simple)
latency_to_switch_interaction <- lmer(latency_to_switch ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(latency_to_switch_interaction)
#Number of AOI switches Models
aoi_switches_simple <- lmer(total_aoi_switches ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(aoi_switches_simple)
aoi_switches_interaction <- lmer(total_aoi_switches ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(aoi_switches_interaction)
#Mean fixation duration Models
mean_fixation_dur_simple <- lmer(duration_of_look ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(mean_fixation_dur_simple)
mean_fixation_dur_interaction <- lmer(duration_of_look ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(mean_fixation_dur_interaction)
#Peak pupil size Models
peak_pupil_simple <- lmer(peak_pupil_size_difference ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(peak_pupil_simple)
peak_pupil_interaction <- lmer(peak_pupil_size_difference ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(peak_pupil_interaction)
#Mean pupil size Models
mean_pupil_simple <- lmer(mean_pupil_size_difference ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(mean_pupil_simple)
mean_pupil_interaction <- lmer(mean_pupil_size_difference ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(mean_pupil_interaction)
#Peak pupil latency Models
peak_pupil_latency_simple <- lmer(peak_pupil_latency ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(peak_pupil_latency_simple)
peak_pupil_latency_interaction <- lmer(peak_pupil_latency ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(peak_pupil_latency_interaction)
#First look duration Models
first_look_duration_simple <- lmer(first_look_dur ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(first_look_duration_simple)
first_look_duration_interaction <- lmer(first_look_dur ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial)
summary(first_look_duration_interaction)
#Correct shift to target models - BINOMIAL
correct_shift_simple <- glmer(correct_shift ~ age_months_centred + exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial, family = "binomial")
summary(correct_shift_simple)
correct_shift_interaction <- glmer(correct_shift ~ age_months_centred*exp_to_target_lang_centred + (1|recording_name) + (1|yoked_pair),
data = data_new_dvs_by_trial, family = "binomial")
summary(correct_shift_interaction)
library(DHARMa)
library(performance)
compare_performance(correct_shift_simple , peak_pupil_latency_simple, mean_pupil_simple, peak_pupil_simple,
mean_fixation_dur_simple , aoi_switches_simple, latency_to_switch_simple, prop_looking_diff_simple, number_fixations_simple, prop_looking_simple)
# Extract p-values
p_values <- kbh_correlation_2$P
# Extract p-values
p_values <- kbh_correlation_$P
kbh_correlation <- cor(x=for_correlation, use="pairwise.complete.obs")
kbh_correlation_2<- rcorr(as.matrix(for_correlation))
# Extract p-values
p_values <- kbh_correlation_$P
# Extract p-values
p_values <- kbh_correlation$P
kbh_correlation_2<- rcorr(as.matrix(for_correlation))
# Extract p-values
p_values <- kbh_correlation_2$P
# Flatten the matrix to adjust p-values
p_values_flat <- as.vector(p_values)
# Flatten the matrix to adjust p-values
p_values_flat <- as.vector(p_values)
# Adjust p-values using Bonferroni correction
p_values_adj <- p.adjust(p_values_flat, method = "bonferroni")
# Convert the adjusted p-values back to a matrix
p_values_adj_matrix <- matrix(p_values_adj, ncol = ncol(for_correlation))
test<- as.data.frame(p_values_adj_matrix)
View(test)
test<- as.data.frame(p_values_adj_matrix) %>%
options(scipen = 999, digits = 4)
test<- as.data.frame(p_values_adj_matrix, options(scipen = 999, digits = 4))
View(test)
View(kbh_correlation)
range(kbh_correlation$abs(prop_looking))
range(kbh_correlation$prop_looking)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(dplyr)
library(stringr)
library(Hmisc)
library(corrplot)
library(zoo)
library(tidyverse)
library(eyetrackingR)
load(here("archival_KBH_anonimyzed/kbh_w_items.Rda"))
trial_cutoff <- kbh_w_items %>%
group_by(recording_name) %>%
distinct(studio_project_name, trial_number) %>%
count(studio_project_name, recording_name) %>%
group_by(studio_project_name) %>%
rename(n_trials_subject = n) %>%
mutate(max_trials_study = max(n_trials_subject)) %>%
distinct(studio_project_name, max_trials_study)
n_subjects_original <- n_distinct(kbh_w_items$recording_name)
trackloss_cleaned <- kbh_w_items %>%
#for each kid in each trial,
group_by(recording_name, trial_number) %>%
#filter to interest period
filter(noun_onset>= 360 & noun_onset <= 3000) %>%
#get trackloss percentage
mutate(trackloss_pct = sum(trackloss == TRUE)/n(),
trackloss_cutoff = case_when(trackloss_pct <.5 ~ "keep",
trackloss_pct >= .5 ~ "exclude")) %>%
ungroup() %>%
distinct(recording_name, trial_number, trackloss_pct, trackloss_cutoff) %>%
filter(trackloss_cutoff == "keep") %>%
group_by(recording_name) %>%
mutate(n_valid_trials_subject = n()) %>%
ungroup() %>%
select(recording_name, trial_number, trackloss_pct, n_valid_trials_subject)
n_subjects_after_trackloss_exclusion <- n_distinct(trackloss_cleaned$recording_name)
analysis_dataset <- kbh_w_items %>%
right_join(trackloss_cleaned) %>%
left_join(trial_cutoff) %>%
mutate(trial_n_cutoff = round(max_trials_study*.25, digits = 0)) %>%
filter(n_valid_trials_subject >= trial_n_cutoff) %>%
ungroup()
###### First, create variables that will be useful for the calculations below ## TRY TO DO IT IN THE SAME DATA SET
initial_looks <- analysis_dataset %>%
filter(noun_onset >= 260 & noun_onset < 360) %>%
group_by(recording_name, trial_number, media_name) %>%
summarise(
distractor_count = sum(distractor),
target_count = sum(target),
trackloss_count = sum(trackloss)
)%>%
mutate(initial_look = case_when(target_count >0 ~ "target", #if the child *ever* looks to target during first 100 ms, then counted as initial target look
distractor_count/(distractor_count+trackloss_count) >=0.5 ~ "distractor",
TRUE ~ "neither"))
analysis_dataset <- left_join(analysis_dataset, initial_looks, by= c("recording_name", "trial_number", "media_name"))
analysis_dataset <- analysis_dataset %>%
filter(!(recording_name == "Mix_20_S52" & trial_number > 1))
prop_looking_by_trial <- analysis_dataset %>%
filter(noun_onset>= 360 & noun_onset <= 3000)%>%
group_by(recording_name, subject_id, trial_number, media_name,
age_months, exp_to_target_lang) %>%
summarise(samples_target=sum(target, na.rm = T),
samples_distractor=sum(distractor, na.rm = T))%>%
mutate(prop_looking = samples_target/(samples_target + samples_distractor)) %>%
ungroup()
prop_looking_by_subject <- prop_looking_by_trial %>%
group_by(recording_name) %>%
summarise(prop_looking = mean(prop_looking)) %>%
ungroup()
prop_looking_diff_by_item <- analysis_dataset %>%
ungroup()%>%
filter(noun_onset>= 360 & noun_onset <= 3000)%>%
select(recording_name, recording_timestamp, target_word, distractor_word, target, distractor)%>%
pivot_longer(c(target_word, distractor_word), names_to = "word_type", values_to = "word") %>%
mutate(looking = case_when(word_type == "target_word" & target == TRUE ~ TRUE,
word_type == "distractor_word" & distractor == TRUE ~ TRUE,
TRUE ~ FALSE)) %>%
group_by(recording_name, word_type, word) %>%
#what percent of the time when x is target are kids looking at x, what percent of the time when x is distractor are kids looking at x
summarise(prop_looking = sum(looking == T, na.rm = T)/n()) %>%
pivot_wider(names_from = "word_type", values_from = "prop_looking") %>%
filter(!is.na(target_word) & !is.na(distractor_word)) %>%
mutate(prop_looking_diff = target_word - distractor_word) %>%
select(recording_name, target_word = word, prop_looking_diff) %>%
ungroup()
prop_looking_diff_by_subject <- prop_looking_diff_by_item %>%
group_by(recording_name) %>% #Calculating this variable by subject instead of by trial for the correlation matrix.
summarise(prop_looking_diff = mean(prop_looking_diff)) %>%
ungroup() #only 165 kids have data for this variable, because they didn't have enough data/trials included with both words of each yoked pair
#For this one, stretches of same looks are counted as one fixation
fixations_total_by_trial <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 3000) %>%
group_by(recording_name, trial_number) %>%
mutate(trackloss_group_id = data.table::rleid(trackloss)) %>%
group_by(trackloss_group_id, recording_name, trial_number) %>%
mutate(num_consec_trackloss_rows = n()) %>%
ungroup() %>%
filter(trackloss == FALSE | (trackloss == TRUE & num_consec_trackloss_rows >= 2)) %>%
group_by(recording_name, trial_number) %>%
mutate(looking_stretch_id = data.table::rleid(target)) %>%
group_by(recording_name, trial_number, looking_stretch_id) %>%
#filter to fixations of at least 12 rows or ~ 200 ms
filter(n() >= 12) %>%
#filter to target fixations
filter(target == TRUE) %>%
distinct(recording_name, trial_number, looking_stretch_id) %>%
group_by(recording_name, trial_number) %>%
summarise(number_fixations = n()) %>%
ungroup()
fixations_total_by_subject <- fixations_total_by_trial %>%
group_by(recording_name) %>%
summarise(number_fixations = sum(number_fixations)) %>%
ungroup()
first_shift_target <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 1800) %>% #Keeping the shorter window to be consistent with Fernald
#Grouping and summarizing to get by subject by trial flagging of whether there was switching or not.
group_by(recording_name, subject_id, trial_number, media_name, initial_look) %>%
summarise(target = sum(target, na.rm = T),
distractor =  sum(distractor, na.rm = T)) %>% #Counting how many looks to target and distractor by timeslice grouped by target or distractor initial trials.
ungroup() %>%
mutate(correct_shift = case_when(initial_look == "target" & distractor ==0 ~ TRUE,
initial_look == "distractor" & target >0 ~ TRUE,
TRUE~FALSE)) #Making a column to calculate correct shifts. We defined correct shift as never looking to the distractor on target initial trial, or switching to the taget on distractor initial trials
prop_shifts_distractor_initial_by_trial <- first_shift_target %>%
filter(initial_look == "distractor")
prop_shifts_distractor_initial_by_subject <- prop_shifts_distractor_initial_by_trial %>%
group_by(recording_name) %>%
summarise(prop_shift_distractor_initial = sum(correct_shift == TRUE)/n())
prop_shifts_target_initial_by_trial <- first_shift_target %>%
filter(initial_look == "target")
prop_shifts_target_initial_by_subject <- prop_shifts_target_initial_by_trial %>%
group_by(recording_name) %>%
summarise(prop_shift_target_initial = sum(correct_shift == TRUE)/n())
RT_by_trial <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 1800) %>% #Keeping the shorter window to be consistent with Fernald
#Grouping and summarizing to get by subject by trial flagging of whether there was switching or not.
filter(initial_look == "distractor") %>%
filter(target == TRUE) %>%
group_by(trial_number, media_name, recording_name, subject_id, initial_look, target) %>%
slice_head() %>%
mutate(latency_to_switch = noun_onset - 360) %>%
ungroup() %>%
select(recording_name, trial_number, latency_to_switch)
RT_by_subject <- RT_by_trial %>%
group_by(recording_name) %>%
summarise(mean_RT = mean(latency_to_switch, na.rm = T)) %>%
ungroup()
number_of_switches_by_trial <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 3000) %>%
#for this one, get rid of track loss rows
filter(trackloss == FALSE) %>%
group_by(recording_name, trial_number) %>%
mutate(looking_stretch_id = data.table::rleid(target)) %>%
group_by(recording_name, trial_number, looking_stretch_id) %>%
#keep stretches that are at least 200 ms or 12 rows
filter(n() >= 12) %>%
mutate(where_looking = case_when(target == TRUE ~ "target",
distractor == TRUE ~ "distractor",
TRUE ~ "neither")) %>%
filter(where_looking != "neither") %>%
distinct(recording_name, trial_number, looking_stretch_id, where_looking, media_name, subject_id) %>%
group_by(recording_name, trial_number) %>%
mutate(AOI_switches = case_when(lag(where_looking) == "target" & where_looking == "distractor" ~ 1,
lag(where_looking) == "distractor" & where_looking == "target" ~ 1)) %>%
group_by(recording_name, trial_number) %>%
summarise(total_aoi_switches = sum(AOI_switches, na.rm = T)) %>%
ungroup()
number_of_switches_by_subject <- number_of_switches_by_trial %>%
group_by(recording_name) %>%
summarise(total_aoi_switches = sum(total_aoi_switches, na.rm = T)) %>%
ungroup()
mean_fixation_dur_by_trial <- analysis_dataset %>%
filter(noun_onset>= 360 & noun_onset <= 3000)%>%
group_by(recording_name, trial_number) %>%
mutate(trackloss_group_id = data.table::rleid(trackloss)) %>%
group_by(trackloss_group_id, recording_name, trial_number) %>%
mutate(num_consec_trackloss_rows = n()) %>%
ungroup() %>%
filter(trackloss == FALSE | (trackloss == TRUE & num_consec_trackloss_rows >= 2)) %>%
group_by(recording_name, trial_number) %>%
mutate(looking_stretch_id = data.table::rleid(target)) %>%
group_by(recording_name, trial_number, looking_stretch_id) %>%
#filter to fixations of at least 12 rows or ~ 200 ms
filter(n() >= 12) %>%
filter(target == TRUE) %>%
group_by(recording_name, trial_number, media_name, looking_stretch_id) %>%
summarise(length_of_looks = n()) %>%
mutate(duration_of_look = length_of_looks*(1000/60)) %>%
group_by(recording_name, trial_number) %>%
summarise(duration_of_look = mean(duration_of_look, na.rm = T)) %>%
ungroup()
mean_fixation_dur_by_subject <- mean_fixation_dur_by_trial %>%
group_by(recording_name) %>%
summarise(duration_of_look = mean(duration_of_look, na.rm = T)) %>%
ungroup()
pupil_dilation <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset>= -200 & noun_onset <= 500)%>%
mutate(pupil_period = case_when(noun_onset >= -200 & noun_onset <= 0 ~ "baseline",
TRUE ~ "post_onset"))%>%
select(recording_timestamp, subject_id, recording_name, trial_number, media_name, pupil_period, pupil_right, pupil_left) %>%
mutate(two_pupil_mean = case_when(is.na(pupil_left) & is.na(pupil_right) ~ NA,
is.na(pupil_left)  ~ pupil_right,
is.na(pupil_right) ~ pupil_left,
TRUE ~ (pupil_left + pupil_right)/2)) %>%
filter(!is.na(two_pupil_mean))
#Peak dilation
peak_dilation_by_trial <- pupil_dilation %>%
ungroup()%>%
group_by(trial_number, recording_name, pupil_period) %>%
summarise(peak_pupil = max(two_pupil_mean)) %>%
pivot_wider(names_from = pupil_period, values_from ="peak_pupil")%>%
mutate(peak_pupil_size_difference = post_onset - baseline) %>% #difference in peak pupil points
filter(!is.na(peak_pupil_size_difference)) %>%
rename(max_pupil_baseline = baseline,
max_pupil_post_onset = post_onset) %>%
ungroup()
peak_dilation_by_subject <- peak_dilation_by_trial %>%
group_by(recording_name) %>%
summarise(peak_pupil_size_difference = mean(peak_pupil_size_difference)) %>%
ungroup()
#Mean dilation
mean_dilation_by_trial <- pupil_dilation %>%
ungroup()%>%
group_by(trial_number, recording_name, pupil_period) %>%
summarise(mean_pupil = mean(two_pupil_mean, na.rm = T)) %>%
pivot_wider(names_from = pupil_period, values_from ="mean_pupil")%>%
mutate(mean_pupil_size_difference = post_onset - baseline) %>% #difference in peak pupil points
filter(!is.na(mean_pupil_size_difference)) %>%
rename(mean_pupil_baseline = baseline,
mean_pupil_post_onset = post_onset) %>%
ungroup()
mean_dilation_by_subject <- mean_dilation_by_trial %>%
group_by(recording_name) %>%
summarise(mean_pupil_size_difference = mean(mean_pupil_size_difference)) %>%
ungroup()
#peak latency
peak_pupil_latency_by_trial <- pupil_dilation %>%
ungroup()%>%
group_by(trial_number, recording_name, pupil_period) %>%
slice(which.max(two_pupil_mean)) %>%
select(recording_name, pupil_period, peak_time_stamp = recording_timestamp) %>%
group_by(trial_number, recording_name) %>%
summarise(peak_pupil_latency = diff(peak_time_stamp)) %>%
ungroup()
peak_pupil_latency_by_subject <- peak_pupil_latency_by_trial %>%
group_by(recording_name) %>%
summarise(peak_pupil_latency = mean(peak_pupil_latency))
first_look_duration_by_trial <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 3000) %>%
group_by(recording_name, trial_number) %>%
mutate(looking_stretch_id = data.table::rleid(target)) %>%
group_by(recording_name, trial_number, looking_stretch_id) %>%
mutate(row = row_number()) %>%
mutate(where_looking = case_when(target == TRUE ~ "target",
distractor == TRUE ~ "distractor",
TRUE ~ "neither")) %>%
filter(where_looking == "target") %>%
mutate(first_look_dur = max(row_number())*(1000/60)) %>%
filter(first_look_dur >= 200) %>%
group_by(trial_number, recording_name) %>%
filter(looking_stretch_id == min(looking_stretch_id)) %>%
ungroup() %>%
distinct(recording_name, trial_number, media_name, first_look_dur) %>%
ungroup()
first_look_duration_by_trial <- analysis_dataset %>%
ungroup() %>%
filter(noun_onset >= 360 & noun_onset <= 3000) %>%
group_by(recording_name, trial_number) %>%
mutate(looking_stretch_id = data.table::rleid(target)) %>%
group_by(recording_name, trial_number, looking_stretch_id) %>%
mutate(row = row_number()) %>%
mutate(where_looking = case_when(target == TRUE ~ "target",
distractor == TRUE ~ "distractor",
TRUE ~ "neither")) %>%
filter(where_looking == "target") %>%
mutate(first_look_dur = max(row_number())*(1000/60)) %>%
filter(first_look_dur >= 200) %>%
group_by(trial_number, recording_name) %>%
filter(looking_stretch_id == min(looking_stretch_id)) %>%
ungroup() %>%
distinct(recording_name, trial_number, media_name, first_look_dur) %>%
ungroup()
first_look_duration_by_subject <- first_look_duration_by_trial %>%
group_by(recording_name) %>%
summarise(first_look_dur = mean(first_look_dur, na.rm = T)) %>%
ungroup()
